<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gi·∫£i B√≥ng ƒê√° Mini | Tr∆∞·ªùng Ti·ªÉu h·ªçc V√µ Th·ªã S√°u</title>
  <meta name="description" content="Trang truy·ªÅn th√¥ng Gi·∫£i B√≥ng ƒê√° Mini h·ªçc sinh 2025‚Äì2026 ‚Äì Tr∆∞·ªùng Ti·ªÉu h·ªçc V√µ Th·ªã S√°u, Q. H·∫£i Ch√¢u, ƒê√† N·∫µng."/>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚öΩ</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700&family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--primary:#0b79d0;--secondary:#12b886;--accent:#ffb703;--ink:#153b5a;--bg:#f4f9ff;--card:#fff;--ring:0 12px 30px rgba(11,121,208,.12)}
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);font-family:'Nunito',system-ui,Segoe UI,Roboto,sans-serif}
    img{max-width:100%;height:auto}
    a{color:var(--primary);text-decoration:none}
    .container{max-width:1140px;margin:0 auto;padding:0 1.25rem}

    /* NAV */
    .nav{position:sticky;top:0;z-index:40;background:#fff;border-bottom:1px solid #e8eef6}
    .nav .inner{display:flex;align-items:center;gap:1rem;padding:.6rem 0}
    .brand{display:flex;align-items:center;gap:.6rem}
    .brand img{width:44px;height:44px;border-radius:10px}
    .brand .name{font-family:'Baloo 2',cursive;font-size:1.1rem;line-height:1}
    .nav ul{list-style:none;display:flex;gap:1rem;margin-left:auto;padding:0}
    .btn{display:inline-flex;align-items:center;gap:.5rem;border:0;border-radius:14px;padding:.8rem 1.05rem;font-weight:800;box-shadow:var(--ring);cursor:pointer}
    .btn.primary{background:var(--primary);color:#fff}
    .btn.secondary{background:var(--secondary);color:#fff}
    .btn.accent{background:var(--accent);color:#1b2832}
    .chip{display:inline-flex;align-items:center;gap:.4rem;background:#e9f5ff;border:1px solid #d6ecff;color:#0a5aa0;border-radius:999px;padding:.35rem .6rem;font-weight:700}

    /* HERO */
    .hero{position:relative;isolation:isolate;background:linear-gradient(180deg,#dff1ff 0, #eff8ff 60%, transparent)}
    .hero .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:2rem;align-items:center;padding:2rem 0 2.4rem}
    h1{font-family:'Baloo 2',cursive;font-size:clamp(1.9rem,3.4vw,3.2rem);line-height:1.1;margin:.2rem 0}
    .tagline{color:#6d8daa;font-weight:700}
    .hero-points{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-top:1rem}
    .card{background:var(--card);border:1px solid #e7eef5;padding:1rem;border-radius:18px;box-shadow:var(--ring)}
    .card h3{margin:.2rem 0 .5rem;font-size:1.05rem}
    .photo{border-radius:22px;border:6px solid #fff;box-shadow:var(--ring)}
    .countdown{display:flex;gap:.6rem;margin-top:1rem;flex-wrap:wrap}
    .countdown .box{min-width:74px;text-align:center;background:#fff;border:1px solid #e7eef5;border-radius:12px;padding:.55rem .65rem}
    .countdown .num{font-weight:900;font-size:1.3rem;color:var(--primary)}

    section{padding:2.6rem 0}
    .title{display:flex;align-items:center;gap:.6rem;font-family:'Baloo 2';font-size:1.6rem}
    .dot{width:12px;height:12px;border-radius:999px;background:var(--accent)}
    .grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:1.1rem}
    .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem}

    .timetable{width:100%;border-collapse:separate;border-spacing:0 .6rem}
    .timetable tr{background:#fff;border-radius:12px;box-shadow:var(--ring)}
    .timetable td{padding:.85rem 1rem;border-top:1px solid #eef4fb;border-bottom:1px solid #eef4fb}
    .timetable td:first-child{width:86px;font-weight:800;color:#0b5ca3;border-left:1px solid #eef4fb;border-top-left-radius:12px;border-bottom-left-radius:12px}
    .timetable td:last-child{border-right:1px solid #eef4fb;border-top-right-radius:12px;border-bottom-right-radius:12px}

    /* BRACKET */
    .bracket-label{font-size:.9rem;fill:#245b82}
    .seed{font-weight:800;fill:#0b5ca3}
    .team{font-weight:800;fill:#12324a}
    .connector{stroke:#cfe6ff;stroke-width:2}
    .slot{filter:drop-shadow(0 4px 12px rgba(11,121,208,.12))}
    input.score{width:56px;text-align:center;border:1px solid #dbe7f4;border-radius:10px;padding:.35rem .4rem;font-weight:800}
    input.score:disabled{background:#f2f7fc;color:#8aa3ba}
    
    /* FIXTURE MATCH CARD */
    .match-card{background:#fff;border:1px solid #e7eef5;border-radius:12px;padding:.8rem;margin-bottom:.6rem;box-shadow:0 2px 8px rgba(11,121,208,.08)}
    .match-teams{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}
    .match-teams .team{font-weight:800;color:var(--primary);flex:1;text-align:center}
    .match-teams .vs{color:#8aa3ba;font-weight:600;padding:0 .5rem}
    .match-scores{display:flex;justify-content:center;gap:.5rem;align-items:center}
    .match-scores input{width:64px;height:40px;text-align:center;border:2px solid #dbe7f4;border-radius:10px;font-weight:900;font-size:1.1rem}
    .match-scores input:focus{outline:none;border-color:var(--primary)}
    .match-scores .colon{font-weight:900;font-size:1.2rem;color:#6d8daa}

    /* GALLERY */
    .gallery{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1rem;margin-top:1rem}
    .gallery img{width:100%;height:200px;object-fit:cover;border-radius:14px;box-shadow:0 6px 14px rgba(0,0,0,.08)}
    iframe.drive{width:100%;height:560px;border:0;border-radius:12px}

    /* FOOTER */
    footer{background:#0b2740;color:#d3e9ff;padding:1.6rem 0;margin-top:1.8rem}
    footer a{color:#ffd166}

    @media(max-width:900px){
      .hero .grid{grid-template-columns:1fr}
      .hero-points{grid-template-columns:1fr 1fr}
      .grid-2{grid-template-columns:1fr}
      .grid-3{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="nav">
    <div class="container inner">
      <div class="brand">
        <img src="logo.jpg" alt="Logo Tr∆∞·ªùng Ti·ªÉu h·ªçc V√µ Th·ªã S√°u"/>
        <div class="name">Tr∆∞·ªùng Ti·ªÉu h·ªçc <strong>V√µ Th·ªã S√°u</strong></div>
      </div>
      <ul>
        <li><a href="#muctieu">M·ª•c ti√™u</a></li>
        <li><a href="#lich">L·ªãch thi ƒë·∫•u</a></li>
        <li><a href="#sodo">S∆° ƒë·ªì</a></li>
        <li><a href="#album">Album</a></li>
      </ul>
      <a class="btn secondary" href="kehoach.pdf" download>üìÑ T·∫£i k·∫ø ho·∫°ch</a>
    </div>
  </nav>

  <!-- HERO -->
  <header class="hero">
    <div class="container grid">
      <div>
        <span class="chip">‚öΩ Gi·∫£i B√≥ng ƒê√° Mini 2025‚Äì2026</span>
        <h1>S√¢n ch∆°i ƒëo√†n k·∫øt ‚Äì kh·ªèe ‚Äì vui cho h·ªçc sinh kh·ªëi 4 & 5</h1>
        <p class="tagline">Khai m·∫°c 15:00 ng√†y 16/10/2025 ‚Äì S√¢n b√≥ng An Ph√∫c. Chung k·∫øt 02/11/2025.</p>
        <div class="countdown" id="countdown"></div>
        <div style="display:flex;gap:.75rem;margin-top:1rem;flex-wrap:wrap">
          <a class="btn primary" href="#dangky">ƒêƒÉng k√Ω / B·ªëc thƒÉm</a>
          <a class="btn accent" href="#lich">Xem l·ªãch</a>
        </div>
        <div class="hero-points">
          <div class="card"><h3>üìê Th·ªÉ th·ª©c 5 ng∆∞·ªùi</h3><p>2 hi·ªáp x 15‚Äô (ngh·ªâ 5‚Äô). V√≤ng b·∫£ng + lo·∫°i tr·ª±c ti·∫øp.</p></div>
          <div class="card"><h3>üìç S√¢n b√≥ng An Ph√∫c</h3><p>ƒê·ªãa ƒëi·ªÉm thi ƒë·∫•u ch√≠nh th·ª©c c·ªßa gi·∫£i.</p></div>
          <div class="card"><h3>üèÜ C√∫p ‚Äì C·ªù ‚Äì Huy ch∆∞∆°ng</h3><p>Trao th∆∞·ªüng Nh·∫•t, Nh√¨, Ba cho m·ªói kh·ªëi.</p></div>
        </div>
      </div>
      <div>
        <img class="photo" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgey5OZRPuBGTMt9jpWEcAS7eYY7T_E-Bx39-YkTMso230nypsvsw30NQom6lLhEpi37mFt3QZxFX-zwFk6Y2NXQllpiS-GirXJRfvu9-9SDeYhw_NrK9s7vlQHPjI76s8-NhEfQ5oWd1p6-BTgY7XhZJ0Imr0f-gLCPXq8q5KNSFx6etKShLSMle1znC8/s600-rw/(%20Anhpnng.com%20)%20-%20BONG-DA%20(41).jpg" alt="H·ªçc sinh ch∆°i b√≥ng ƒë√°"/>
      </div>
    </div>
  </header>

  <!-- M·ª§C TI√äU -->
  <section id="muctieu">
    <div class="container">
      <h2 class="title"><span class="dot"></span> M·ª•c ti√™u & ƒê·ªëi t∆∞·ª£ng</h2>
      <div class="grid-3" style="margin-top:1rem">
        <div class="card"><h3>üéØ M·ª•c ti√™u</h3><ul><li>Ch√†o m·ª´ng Ng√†y Nh√† gi√°o Vi·ªát Nam 20/11</li><li>Giao l∆∞u l√†nh m·∫°nh, r√®n luy·ªán s·ª©c kho·∫ª</li><li>Tuy·ªÉn ch·ªçn VƒêV n√≤ng c·ªët c·ªßa tr∆∞·ªùng</li></ul></div>
        <div class="card"><h3>üë¶ ƒê·ªëi t∆∞·ª£ng</h3><p>H·ªçc sinh <strong>kh·ªëi 4,5</strong>. M·ªói l·ªõp 01 ƒë·ªôi nam: 5 ch√≠nh + t·ªëi ƒëa 5 d·ª± b·ªã.</p></div>
        <div class="card"><h3>üí∞ L·ªá ph√≠ & ƒê·ªãa ƒëi·ªÉm</h3><p>L·ªá ph√≠: <strong>300.000ƒë/l·ªõp</strong>. ƒê·ªãa ƒëi·ªÉm: <strong>S√¢n b√≥ng An Ph√∫c ‚Äì V√µ Th·ªã S√°u</strong>.</p></div>
      </div>
    </div>
  </section>

  <!-- L·ªäCH THI ƒê·∫§U -->
  <section id="lich" style="background:linear-gradient(180deg,rgba(18,184,134,.06),transparent)">
    <div class="container">
      <h2 class="title"><span class="dot"></span> L·ªãch thi ƒë·∫•u ch√≠nh</h2>
      <p style="color:#6d8daa">V√≤ng b·∫£ng 16‚Äì18/10 ‚Ä¢ T·ª© k·∫øt 23/10 ‚Ä¢ Chung k·∫øt 02/11</p>
      <div class="grid-2" style="margin-top:1rem">
        <div class="card">
          <h3>Ng√†y 16/10/2025 (Chi·ªÅu)</h3>
          <table class="timetable">
            <tr><td>15:00</td><td>Khai m·∫°c ‚Äì B·ªëc thƒÉm</td></tr>
            <tr><td>15:30</td><td>Kh·ªëi 4 ‚Äì S√¢n 1: 4/2 vs 4/1</td></tr>
            <tr><td>15:30</td><td>Kh·ªëi 4 ‚Äì S√¢n 2: 4/5 vs 4/6</td></tr>
            <tr><td>16:10</td><td>Kh·ªëi 5 ‚Äì S√¢n 1: 5/1 vs 5/3</td></tr>
            <tr><td>16:10</td><td>Kh·ªëi 5 ‚Äì S√¢n 2: 5/6 vs 5/4</td></tr>
          </table>
        </div>
        <div class="card">
          <h3>Ng√†y 17/10/2025 (S√°ng)</h3>
          <table class="timetable">
            <tr><td>07:30</td><td>Kh·ªëi 4 ‚Äì S√¢n 1: 4/1 vs 4/4</td></tr>
            <tr><td>07:30</td><td>Kh·ªëi 4 ‚Äì S√¢n 2: 4/6 vs 4/3</td></tr>
            <tr><td>08:10</td><td>Kh·ªëi 5 ‚Äì S√¢n 1: 5/3 vs 5/2</td></tr>
            <tr><td>08:10</td><td>Kh·ªëi 5 ‚Äì S√¢n 2: 5/4 vs 5/5</td></tr>
          </table>
        </div>
        <div class="card">
          <h3>Ng√†y 18/10/2025 (S√°ng)</h3>
          <table class="timetable">
            <tr><td>07:30</td><td>Kh·ªëi 4 ‚Äì S√¢n 1: 4/2 vs 4/4</td></tr>
            <tr><td>07:30</td><td>Kh·ªëi 4 ‚Äì S√¢n 2: 4/5 vs 4/3</td></tr>
            <tr><td>08:10</td><td>Kh·ªëi 5 ‚Äì S√¢n 1: 5/1 vs 5/2</td></tr>
            <tr><td>08:10</td><td>Kh·ªëi 5 ‚Äì S√¢n 2: 5/6 vs 5/5</td></tr>
          </table>
        </div>
        <div class="card">
          <h3>T·ª© k·∫øt & Chung k·∫øt</h3>
          <table class="timetable">
            <tr><td>23/10 ‚Äì 15:00</td><td>T·ª© k·∫øt (Nh·∫•t A vs Nh√¨ B ‚Ä¢ Nh·∫•t B vs Nh√¨ A)</td></tr>
            <tr><td>02/11 ‚Äì 07:30</td><td>Tranh Ba T∆∞ & Chung k·∫øt</td></tr>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- NH·∫¨P K·∫æT QU·∫¢ + B·∫¢NG X·∫æP H·∫†NG -->
  <section id="sodo">
    <div class="container">
      <h2 class="title"><span class="dot"></span> Nh·∫≠p k·∫øt qu·∫£ & S∆° ƒë·ªì nh√°nh ƒë·∫•u</h2>
      <div class="card" style="margin-bottom:1rem">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap">
          <strong>Ch·∫ø ƒë·ªô qu·∫£n tr·ªã</strong>
          <div style="display:flex;gap:.5rem;align-items:center;flex-wrap:wrap">
            <button class="btn accent" id="toggleEdit">B·∫≠t ch·∫ø ƒë·ªô nh·∫≠p (PIN)</button>
            <button class="btn primary" id="loadFromSheet">‚¨áÔ∏è T·∫£i t·ª´ Sheet</button>
            <button class="btn secondary" id="exportData">‚¨ÜÔ∏è ƒê·∫©y l√™n Sheet</button>
            <button class="btn" id="clearData">Xo√° d·ªØ li·ªáu</button>
          </div>
        </div>
        <small style="color:#6d8daa">
          <strong>Ch·∫ø ƒë·ªô Admin:</strong> Nh·∫≠p PIN ‚Üí Nh·∫≠p t·ªâ s·ªë tr√™n web ‚Üí Nh·∫•n "ƒê·∫©y l√™n Sheet" ‚Üí T·ª± ƒë·ªông l∆∞u v√†o Google Sheet!<br/>
          <strong>Ch·∫ø ƒë·ªô Xem:</strong> Trang t·ª± ƒë·ªông t·∫£i t·ªâ s·ªë t·ª´ Google Sheet m·ªói 1 ph√∫t (ho·∫∑c nh·∫•n "T·∫£i t·ª´ Sheet").
        </small>
        <div id="sheetStatus" style="margin-top:.5rem;padding:.5rem;border-radius:8px;display:none"></div>
      </div>

      <div class="grid-2">
        <div class="card">
          <h3>Nh·∫≠p t·ªâ s·ªë v√≤ng b·∫£ng</h3>
          <div class="grid-2">
            <div>
              <h4>Kh·ªëi 4</h4>
              <div id="fixturesA"></div>
            </div>
            <div>
              <h4>Kh·ªëi 5</h4>
              <div id="fixturesB"></div>
            </div>
          </div>
        </div>
        <div class="card">
          <h3>B·∫£ng x·∫øp h·∫°ng</h3>
          <div class="grid-2">
            <div>
              <h4>Kh·ªëi 4</h4>
              <table class="timetable" id="groupA"></table>
            </div>
            <div>
              <h4>Kh·ªëi 5</h4>
              <table class="timetable" id="groupB"></table>
            </div>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:1rem">
        <h3>Nh·∫≠p t·ªâ s·ªë v√≤ng lo·∫°i tr·ª±c ti·∫øp</h3>
        <div class="grid-2">
          <div>
            <h4>B√°n k·∫øt</h4>
            <div id="knockoutFixtures"></div>
          </div>
          <div>
            <h4>Chung k·∫øt & Tranh Ba</h4>
            <div id="finalFixtures"></div>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:1rem">
        <h3>Nh√°nh ƒë·∫•u (B√°n k·∫øt ‚Üí CK)</h3>
        <svg id="bracket" viewBox="0 0 800 360" style="width:100%;height:auto;border-radius:12px;background:#f8fbff;border:1px solid #e6eef7"></svg>
        <div class="chip" style="margin:.5rem 0 0">üèÜ Chung k·∫øt 02/11/2025</div>
      </div>

      <details style="margin-top:1rem">
        <summary style="cursor:pointer;font-weight:800">‚öôÔ∏è C·∫•u h√¨nh ƒë·ªôi (c√≥ th·ªÉ ch·ªânh JSON)</summary>
        <pre id="dataEditor" contenteditable style="white-space:pre;display:block;background:#0b2740;color:#cfe6ff;padding:1rem;border-radius:12px;box-shadow:var(--ring);overflow:auto">{
  "groups": {
    "K4": [
      {"team":"4/1"},{"team":"4/2"},{"team":"4/3"},{"team":"4/4"},{"team":"4/5"},{"team":"4/6"}
    ],
    "K5": [
      {"team":"5/1"},{"team":"5/2"},{"team":"5/3"},{"team":"5/4"},{"team":"5/5"},{"team":"5/6"}
    ]
  }
}</pre>
      </details>
    </div>
  </section>

  <!-- ALBUM -->
  <section id="album" style="background:linear-gradient(180deg,rgba(255,183,3,.08),transparent)">
    <div class="container">
      <h2 class="title"><span class="dot"></span> Album & Kho·∫£nh kh·∫Øc</h2>
      <p style="color:#6d8daa">Th∆∞ m·ª•c chung: ph·ª• huynh & gi√°o vi√™n c√≥ th·ªÉ t·∫£i ·∫£nh/video. ·∫¢nh tr√™n trang hi·ªÉn th·ªã ng·∫´u nhi√™n (kh√¥ng d√πng API).</p>
      <div style="margin:1rem 0">
        <a class="btn primary" target="_blank" href="https://drive.google.com/drive/folders/1mXQXp9gXpX-rai26npHtCEcb8JaMM7xi?usp=sharing">üìÅ M·ªü th∆∞ m·ª•c Google Drive</a>
      </div>
      <div class="gallery" id="randomGallery"></div>
      <iframe class="drive" src="https://drive.google.com/embeddedfolderview?id=1mXQXp9gXpX-rai26npHtCEcb8JaMM7xi#grid" allowfullscreen title="Album Drive"></iframe>
    </div>
  </section>

  <footer>
    <div class="container" style="display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap">
      <div style="display:flex;align-items:center;gap:.6rem"><img src="logo.jpg" alt="Logo" style="width:44px;height:44px;border-radius:10px"> <strong>Tr∆∞·ªùng Ti·ªÉu h·ªçc V√µ Th·ªã S√°u</strong></div>
      <div>¬© 2025 ‚Ä¢ Gi·∫£i B√≥ng ƒê√° Mini H·ªçc Sinh</div>
    </div>
  </footer>

  <script>
    // COUNTDOWN
    (function(){
      const target=new Date('2025-10-16T15:00:00');
      const el=document.getElementById('countdown');
      const box=(n,l)=>`<div class="box"><div class="num">${n}</div><div>${l}</div></div>`;
      function tick(){const now=new Date();let d= Math.max(0,target-now);const dd=Math.floor(d/86400000);d-=dd*86400000;const h=Math.floor(d/3600000);d-=h*3600000;const m=Math.floor(d/60000);d-=m*60000;const s=Math.floor(d/1000);el.innerHTML=box(dd,'ng√†y')+box(h,'gi·ªù')+box(m,'ph√∫t')+box(s,'gi√¢y');}
      tick();setInterval(tick,1000);
    })();

    // ===== K·∫æT QU·∫¢ T·ª∞ T√çNH + PIN + GOOGLE SHEETS =====
    (function(){
      const $ = (s) => document.querySelector(s);
      const ADMIN_PIN = '2468';
      
      // URL Google Apps Script - API ƒë√£ deploy
      const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw3ia4q0Z6qCyO7SCJRCIdTtgtV-w5DvGhYa1nLFz0PEtefklFjK-aFu2Qadr_4Bz4/exec';
      
      let editEnabled = false;
      let results = JSON.parse(localStorage.getItem('vts_results') || '{}');
      
      // L·ªãch thi ƒë·∫•u c·ªë ƒë·ªãnh theo b·ªëc thƒÉm
      const FIXTURES = {
        K4: [
          ['4/2','4/1'], ['4/5','4/6'],  // 16/10
          ['4/1','4/4'], ['4/6','4/3'],  // 17/10
          ['4/2','4/4'], ['4/5','4/3']   // 18/10
        ],
        K5: [
          ['5/1','5/3'], ['5/6','5/4'],  // 16/10
          ['5/3','5/2'], ['5/4','5/5'],  // 17/10
          ['5/1','5/2'], ['5/6','5/5']   // 18/10
        ]
      };

      function pairs(list, groupKey) {
        return FIXTURES[groupKey] || [];
      }

      function key(g, a, b) {
        return `${g}_${a}_${b}`;
      }

      function getScore(g, a, b) {
        const k = key(g, a, b);
        const score = results[k] || ['', ''];
        return score;
      }

      function setScore(g, a, b, va, vb) {
        results[key(g, a, b)] = [va, vb];
        localStorage.setItem('vts_results', JSON.stringify(results));
        refreshAll();
      }

      // H√†m x·ª≠ l√Ω ng∆∞·ªùi th·∫Øng b√°n k·∫øt
      function getSemiFinalWinner(team1, team2, score) {
        if (!team1 || !team2) return '‚Äî';
        const [s1, s2] = score;
        if (s1 === '' || s2 === '') return 'Ch∆∞a ƒë·∫•u';
        const score1 = Number(s1);
        const score2 = Number(s2);
        if (score1 > score2) return team1;
        if (score2 > score1) return team2;
        return 'H√≤a (lu√¢n l∆∞u)'; // Trong th·ª±c t·∫ø c·∫ßn lu√¢n l∆∞u
      }

      // H√†m x·ª≠ l√Ω ng∆∞·ªùi th·∫Øng chung k·∫øt  
      function getFinalWinner(winner1, winner2, score) {
        if (winner1 === '‚Äî' || winner2 === '‚Äî' || winner1 === 'Ch∆∞a ƒë·∫•u' || winner2 === 'Ch∆∞a ƒë·∫•u') return '‚Äî';
        const [s1, s2] = score;
        if (s1 === '' || s2 === '') return 'Ch∆∞a ƒë·∫•u';
        const score1 = Number(s1);
        const score2 = Number(s2);
        if (score1 > score2) return winner1;
        if (score2 > score1) return winner2;
        return 'H√≤a (lu√¢n l∆∞u)';
      }

      // H√†m l·∫•y t·ªâ s·ªë chung k·∫øt v·ªõi t√™n ƒë·ªôi th·ª±c t·∫ø
      function getFinalScore(winner1, winner2) {
        if (winner1 === '‚Äî' || winner2 === '‚Äî' || winner1 === 'Ch∆∞a ƒë·∫•u' || winner2 === 'Ch∆∞a ƒë·∫•u') {
          return ['', ''];
        }
        return getScore('FINAL', winner1, winner2);
      }

      function parseGroups() {
        const defaultGroups = {
          K4: [
            {team:"4/1"},{team:"4/2"},{team:"4/3"},{team:"4/4"},{team:"4/5"},{team:"4/6"}
          ],
          K5: [
            {team:"5/1"},{team:"5/2"},{team:"5/3"},{team:"5/4"},{team:"5/5"},{team:"5/6"}
          ]
        };

        try {
          const element = $('#dataEditor');
          if (!element || !element.innerText.trim()) {
            return defaultGroups;
          }
          
          const parsed = JSON.parse(element.innerText.trim());
          const groups = parsed.groups || {};
          return {
            K4: groups.K4 || defaultGroups.K4,
            K5: groups.K5 || defaultGroups.K5
          };
        } catch(e) {
          console.error('Error parsing groups, using defaults:', e);
          return defaultGroups;
        }
      }

      function renderFixtures(groups) {
        ['K4','K5'].forEach(g => {
          const groupLetter = g === 'K4' ? 'A' : 'B';
          const host = $(`#fixtures${groupLetter}`);
          const matches = pairs(groups[g] || [], g).map(([a, b]) => {
            const [sa, sb] = getScore(g, a, b);
            return `<div class="match-card">
              <div class="match-teams">
                <div class="team">${a}</div>
                <div class="vs">vs</div>
                <div class="team">${b}</div>
              </div>
              <div class="match-scores">
                <input type="number" min="0" value="${sa}" 
                  data-g="${g}" data-a="${a}" data-b="${b}" data-pos="a" 
                  placeholder="0"
                  ${editEnabled ? '' : 'disabled'} />
                <span class="colon">:</span>
                <input type="number" min="0" value="${sb}" 
                  data-g="${g}" data-a="${a}" data-b="${b}" data-pos="b" 
                  placeholder="0"
                  ${editEnabled ? '' : 'disabled'} />
              </div>
            </div>`;
          }).join('');
          host.innerHTML = matches;
          
          // Th√™m event listener cho c√°c input
          host.querySelectorAll('input').forEach(inp => {
            inp.addEventListener('input', (e) => {
              const g = e.target.dataset.g;
              const a = e.target.dataset.a;
              const b = e.target.dataset.b;
              const pos = e.target.dataset.pos;
              const current = getScore(g, a, b);
              if (pos === 'a') {
                setScore(g, a, b, e.target.value, current[1]);
              } else {
                setScore(g, a, b, current[0], e.target.value);
              }
            });
          });
        });
      }

      function refreshAll() {
        const groups = parseGroups();
        renderFixtures(groups);
        const withPts = pointsFromResults(groups);
        renderStandings('A', withPts.K4);
        renderStandings('B', withPts.K5);
        drawBracket(withPts);
        
        // Render knockout fixtures v·ªõi d·ªØ li·ªáu ƒë√£ s·∫Øp x·∫øp
        renderKnockoutFixtures(withPts);
      }

      function renderKnockoutFixtures(groups) {
        // L·∫•y top 2 m·ªói b·∫£ng
        const K4Top = groups.K4.slice(0, 2);
        const K5Top = groups.K5.slice(0, 2);
        
        // Ki·ªÉm tra xem ƒë√£ c√≥ k·∫øt qu·∫£ thi ƒë·∫•u ch∆∞a (ƒëi·ªÉm > 0)
        const hasK4Results = K4Top[0]?.points > 0;
        const hasK5Results = K5Top[0]?.points > 0;
        
        // B√°n k·∫øt: Nh·∫•t K4 vs Nh√¨ K5, Nh·∫•t K5 vs Nh√¨ K4
        const sf1Team1 = hasK4Results ? (K4Top[0]?.team || '‚Äî') : 'Nh·∫•t K4'; 
        const sf1Team2 = hasK5Results ? (K5Top[1]?.team || '‚Äî') : 'Nh√¨ K5';
        const sf2Team1 = hasK5Results ? (K5Top[0]?.team || '‚Äî') : 'Nh·∫•t K5';
        const sf2Team2 = hasK4Results ? (K4Top[1]?.team || '‚Äî') : 'Nh√¨ K4';
        

        
        const sf1Score = getScore('SF', sf1Team1, sf1Team2);
        const sf2Score = getScore('SF', sf2Team1, sf2Team2);
        
        // Ng∆∞·ªùi th·∫Øng b√°n k·∫øt
        const sf1Winner = getSemiFinalWinner(sf1Team1, sf1Team2, sf1Score);
        const sf2Winner = getSemiFinalWinner(sf2Team1, sf2Team2, sf2Score);
        
        const knockoutHtml = `
          <div class="match-card">
            <div class="match-teams">
              <div class="team">${sf1Team1}</div>
              <div class="vs">vs</div>
              <div class="team">${sf1Team2}</div>
            </div>
            <div class="match-scores">
              <input type="number" min="0" value="${sf1Score[0]}" 
                data-g="SF" data-a="${sf1Team1}" data-b="${sf1Team2}" data-pos="a" 
                placeholder="0" ${editEnabled ? '' : 'disabled'} />
              <span class="colon">:</span>
              <input type="number" min="0" value="${sf1Score[1]}" 
                data-g="SF" data-a="${sf1Team1}" data-b="${sf1Team2}" data-pos="b" 
                placeholder="0" ${editEnabled ? '' : 'disabled'} />
            </div>
          </div>
          
          <div class="match-card">
            <div class="match-teams">
              <div class="team">${sf2Team1}</div>
              <div class="vs">vs</div>
              <div class="team">${sf2Team2}</div>
            </div>
            <div class="match-scores">
              <input type="number" min="0" value="${sf2Score[0]}" 
                data-g="SF" data-a="${sf2Team1}" data-b="${sf2Team2}" data-pos="a" 
                placeholder="0" ${editEnabled ? '' : 'disabled'} />
              <span class="colon">:</span>
              <input type="number" min="0" value="${sf2Score[1]}" 
                data-g="SF" data-a="${sf2Team1}" data-b="${sf2Team2}" data-pos="b" 
                placeholder="0" ${editEnabled ? '' : 'disabled'} />
            </div>
          </div>`;
        
        $('#knockoutFixtures').innerHTML = knockoutHtml;
        
        // Chung k·∫øt (ch·ªâ hi·ªán khi c√≥ ng∆∞·ªùi th·∫Øng b√°n k·∫øt)
        if (sf1Winner !== '‚Äî' && sf2Winner !== '‚Äî' && sf1Winner !== 'Ch∆∞a ƒë·∫•u' && sf2Winner !== 'Ch∆∞a ƒë·∫•u') {
          const finalScore = getScore('FINAL', sf1Winner, sf2Winner);
          const finalHtml = `
            <div class="match-card">
              <div class="match-teams">
                <div class="team">${sf1Winner}</div>
                <div class="vs">vs</div>
                <div class="team">${sf2Winner}</div>
              </div>
              <div class="match-scores">
                <input type="number" min="0" value="${finalScore[0]}" 
                  data-g="FINAL" data-a="${sf1Winner}" data-b="${sf2Winner}" data-pos="a" 
                  placeholder="0" ${editEnabled ? '' : 'disabled'} />
                <span class="colon">:</span>
                <input type="number" min="0" value="${finalScore[1]}" 
                  data-g="FINAL" data-a="${sf1Winner}" data-b="${sf2Winner}" data-pos="b" 
                  placeholder="0" ${editEnabled ? '' : 'disabled'} />
              </div>
            </div>`;
          $('#finalFixtures').innerHTML = finalHtml;
        } else {
          $('#finalFixtures').innerHTML = '<p style="color:#6d8daa;text-align:center">Ch∆∞a c√≥ ƒë·ªëi th·ªß chung k·∫øt</p>';
        }
        
        // Th√™m event listeners cho knockout inputs
        document.querySelectorAll('#knockoutFixtures input, #finalFixtures input').forEach(inp => {
          inp.addEventListener('input', (e) => {
            const g = e.target.dataset.g;
            const a = e.target.dataset.a;
            const b = e.target.dataset.b;
            const pos = e.target.dataset.pos;
            const current = getScore(g, a, b);
            if (pos === 'a') {
              setScore(g, a, b, e.target.value, current[1]);
            } else {
              setScore(g, a, b, current[0], e.target.value);
            }
          });
        });
      }

      function pointsFromResults(groups) {
        const stats = {};
        
        // Kh·ªüi t·∫°o th·ªëng k√™ cho t·∫•t c·∫£ ƒë·ªôi
        Object.values(groups).flat().forEach(t => {
          if (t && t.team) {
            stats[t.team] = {
              pts: 0,      // ƒêi·ªÉm
              played: 0,   // S·ªë tr·∫≠n ƒë√£ ƒë·∫•u
              won: 0,      // Th·∫Øng
              draw: 0,     // H√≤a  
              lost: 0,     // Thua
              gf: 0,       // B√†n th·∫Øng
              ga: 0,       // B√†n thua
              gd: 0        // Hi·ªáu s·ªë
            };
          }
        });
        
        // T√≠nh to√°n t·ª´ k·∫øt qu·∫£ c√°c tr·∫≠n ƒë·∫•u
        ['K4','K5'].forEach(g => {
          pairs(groups[g] || [], g).forEach(([a, b]) => {
            const [ra, rb] = getScore(g, a, b);
            const sa = ra === '' ? null : Number(ra);
            const sb = rb === '' ? null : Number(rb);
            
            if (sa != null && sb != null && stats[a] && stats[b]) {
              // C·∫≠p nh·∫≠t s·ªë tr·∫≠n ƒë√£ ƒë·∫•u
              stats[a].played++;
              stats[b].played++;
              
              // C·∫≠p nh·∫≠t b√†n th·∫Øng/thua
              stats[a].gf += sa;
              stats[a].ga += sb;
              stats[b].gf += sb;
              stats[b].ga += sa;
              
              // C·∫≠p nh·∫≠t k·∫øt qu·∫£ tr·∫≠n ƒë·∫•u
              if (sa > sb) {
                stats[a].pts += 3;
                stats[a].won++;
                stats[b].lost++;
              } else if (sa < sb) {
                stats[b].pts += 3;
                stats[b].won++;
                stats[a].lost++;
              } else {
                stats[a].pts += 1;
                stats[b].pts += 1;
                stats[a].draw++;
                stats[b].draw++;
              }
              
              // T√≠nh hi·ªáu s·ªë
              stats[a].gd = stats[a].gf - stats[a].ga;
              stats[b].gd = stats[b].gf - stats[b].ga;
              

            }
          });
        });
        
        // S·∫Øp x·∫øp theo: ƒêi·ªÉm > Hi·ªáu s·ªë > B√†n th·∫Øng
        const sortTeams = (teams) => {
          const sorted = teams
            .filter(t => t && t.team) // L·ªçc c√°c ƒë·ªôi h·ª£p l·ªá
            .map(t => ({
              ...t, 
              ...(stats[t.team] || {
                pts: 0, played: 0, won: 0, draw: 0, lost: 0, 
                gf: 0, ga: 0, gd: 0
              })
            }))
            .sort((a, b) => {
              if (b.pts !== a.pts) return b.pts - a.pts;
              if (b.gd !== a.gd) return b.gd - a.gd;
              return b.gf - a.gf;
            });
            
          return sorted;
        };
        
        return {
          K4: sortTeams(groups.K4 || []),
          K5: sortTeams(groups.K5 || [])
        };
      }

      function renderStandings(gid, arr) {
        const rows = arr.map((t, i) => {
          const pos = i + 1;
          const rowClass = pos <= 2 ? 'style="background:#e7f5ff"' : ''; // Highlight top 2
          return `<tr ${rowClass}>
            <td style="width:40px;text-align:center">${pos}</td>
            <td style="font-weight:800">${t.team}</td>
            <td style="width:40px;text-align:center">${t.played}</td>
            <td style="width:40px;text-align:center">${t.pts}</td>
            <td style="width:50px;text-align:center">${t.gf}:${t.ga}</td>
            <td style="width:40px;text-align:center">${t.gd >= 0 ? '+' : ''}${t.gd}</td>
          </tr>`;
        }).join('');
        
        $(`#group${gid}`).innerHTML = `<tr style="background:#f8fbff">
          <td style="width:40px;text-align:center">#</td>
          <td>ƒê·ªôi</td>
          <td style="width:40px;text-align:center">Tr·∫≠n</td>
          <td style="width:40px;text-align:center">ƒêi·ªÉm</td>
          <td style="width:50px;text-align:center">T-B</td>
          <td style="width:40px;text-align:center">HS</td>
        </tr>` + rows;
      }

      function drawBracket(groups) {
        // L·∫•y top 2 m·ªói b·∫£ng (ƒë√£ ƒë∆∞·ª£c s·∫Øp x·∫øp)
        const K4Top = groups.K4.slice(0, 2);
        const K5Top = groups.K5.slice(0, 2);
        
        // Ki·ªÉm tra xem ƒë√£ c√≥ k·∫øt qu·∫£ thi ƒë·∫•u ch∆∞a (ƒëi·ªÉm > 0)
        const hasK4Results = K4Top[0]?.points > 0;
        const hasK5Results = K5Top[0]?.points > 0;
        
        // X√°c ƒë·ªãnh t√™n hi·ªÉn th·ªã d·ª±a tr√™n k·∫øt qu·∫£ thi ƒë·∫•u
        const sf1Team1 = hasK4Results ? (K4Top[0]?.team || '‚Äî') : 'Nh·∫•t K4';
        const sf1Team2 = hasK5Results ? (K5Top[1]?.team || '‚Äî') : 'Nh√¨ K5';
        const sf2Team1 = hasK5Results ? (K5Top[0]?.team || '‚Äî') : 'Nh·∫•t K5';
        const sf2Team2 = hasK4Results ? (K4Top[1]?.team || '‚Äî') : 'Nh√¨ K4';
        

        
        const svg = $('#bracket');
        while(svg.firstChild) svg.removeChild(svg.firstChild);
        
        const NS = 'http://www.w3.org/2000/svg';
        
        // L·∫•y k·∫øt qu·∫£ c√°c tr·∫≠n knockout  
        const sf1Score = getScore('SF', hasK4Results ? (K4Top[0]?.team || '') : '', hasK5Results ? (K5Top[1]?.team || '') : ''); // B√°n k·∫øt 1
        const sf2Score = getScore('SF', hasK5Results ? (K5Top[0]?.team || '') : '', hasK4Results ? (K4Top[1]?.team || '') : ''); // B√°n k·∫øt 2
        
        // T√≠nh ng∆∞·ªùi th·∫Øng b√°n k·∫øt
        const sf1Winner = getSemiFinalWinner(sf1Team1, sf1Team2, sf1Score);
        const sf2Winner = getSemiFinalWinner(sf2Team1, sf2Team2, sf2Score);
        
        // L·∫•y k·∫øt qu·∫£ chung k·∫øt v·ªõi t√™n ƒë·ªôi th·ª±c t·∫ø
        const finalScore = getFinalScore(sf1Winner, sf2Winner);
        
        // T√≠nh v√¥ ƒë·ªãch
        const champion = getFinalWinner(sf1Winner, sf2Winner, finalScore);
        
        function box(x, y, text, seed) {
          const g = document.createElementNS(NS, 'g');
          g.setAttribute('class', 'slot');
          
          const r = document.createElementNS(NS, 'rect');
          r.setAttribute('x', x);
          r.setAttribute('y', y - 22);
          r.setAttribute('rx', 10);
          r.setAttribute('ry', 10);
          r.setAttribute('width', 260);
          r.setAttribute('height', 44);
          r.setAttribute('fill', '#fff');
          r.setAttribute('stroke', '#e6eef7');
          
          const s = document.createElementNS(NS, 'text');
          s.setAttribute('x', x + 12);
          s.setAttribute('y', y - 4);
          s.setAttribute('class', 'seed');
          s.textContent = seed;
          
          const t = document.createElementNS(NS, 'text');
          t.setAttribute('x', x + 96);
          t.setAttribute('y', y - 4);
          t.setAttribute('class', 'team');
          t.textContent = text;
          
          g.append(r, s, t);
          svg.appendChild(g);
        }
        
        function line(x1, y1, x2, y2) {
          const l = document.createElementNS(NS, 'line');
          l.setAttribute('x1', x1);
          l.setAttribute('y1', y1);
          l.setAttribute('x2', x2);
          l.setAttribute('y2', y2);
          l.setAttribute('class', 'connector');
          svg.appendChild(l);
        }
        
        function label(x, y, text) {
          const t = document.createElementNS(NS, 'text');
          t.setAttribute('x', x);
          t.setAttribute('y', y);
          t.setAttribute('class', 'bracket-label');
          t.textContent = text;
          svg.appendChild(t);
        }
        
        // V·∫Ω b√°n k·∫øt
        box(40, 60, sf1Team1, 'Nh·∫•t K4');
        box(40, 160, sf1Team2, 'Nh√¨ K5');
        box(40, 240, sf2Team1, 'Nh·∫•t K5');
        box(40, 340, sf2Team2, 'Nh√¨ K4');
        
        // V·∫Ω ƒë∆∞·ªùng n·ªëi v√† k·∫øt qu·∫£ b√°n k·∫øt
        line(300, 60, 340, 110);
        line(300, 160, 340, 110);
        box(340, 110, sf1Winner, 'BK 1');
        
        line(300, 240, 340, 290);
        line(300, 340, 340, 290);
        box(340, 290, sf2Winner, 'BK 2');
        
        // V·∫Ω chung k·∫øt
        line(600, 110, 640, 200);
        line(600, 290, 640, 200);
        box(640, 200, champion, 'Chung k·∫øt');
        
        label(680, 240, 'üèÜ ' + (champion === 'Ch∆∞a ƒë·∫•u' || champion === '‚Äî' ? 'V√¥ ƒë·ªãch' : champion));
      }

      $('#toggleEdit').addEventListener('click', () => {
        if (!editEnabled) {
          const pin = prompt('Nh·∫≠p PIN ƒë·ªÉ b·∫≠t ch·∫ø ƒë·ªô nh·∫≠p:');
          if (pin !== '2468') return alert('Sai PIN!');
          editEnabled = true;
          $('#toggleEdit').textContent = 'T·∫Øt ch·∫ø ƒë·ªô nh·∫≠p';
        } else {
          editEnabled = false;
          $('#toggleEdit').textContent = 'B·∫≠t ch·∫ø ƒë·ªô nh·∫≠p (PIN)';
        }
        refreshAll();
      });
      
      $('#clearData').addEventListener('click', () => {
        if (confirm('Xo√° to√†n b·ªô t·ªâ s·ªë ƒë√£ l∆∞u tr√™n thi·∫øt b·ªã?')) {
          localStorage.removeItem('vts_results');
          results = {};
          refreshAll();
        }
      });

      // ===== GOOGLE SHEETS INTEGRATION =====
      
      function showStatus(msg, type = 'info') {
        const status = $('#sheetStatus');
        status.style.display = 'block';
        status.style.background = type === 'success' ? '#d3f9d8' : type === 'error' ? '#ffe3e3' : '#e7f5ff';
        status.style.color = type === 'success' ? '#2b8a3e' : type === 'error' ? '#c92a2a' : '#1971c2';
        status.innerHTML = msg;
        setTimeout(() => { status.style.display = 'none'; }, 5000);
      }
      
      // Load d·ªØ li·ªáu t·ª´ Google Sheet (JSONP - kh√¥ng l·ªói CORS)
      function loadFromGoogleSheet() {
        showStatus('üîÑ ƒêang t·∫£i d·ªØ li·ªáu t·ª´ Google Sheet...', 'info');
        
        // T·∫°o callback function duy nh·∫•t
        const callbackName = 'loadCallback_' + Date.now();
        
        window[callbackName] = function(result) {
          try {
            if (result.status === 'success' && result.data) {
              const newResults = {};
              
                // Parse d·ªØ li·ªáu t·ª´ Apps Script
              result.data.forEach(row => {
                const khoi = row.Khoi || row.khoi;
                const doiA = row.DoiA || row.doiA;
                const doiB = row.DoiB || row.doiB;
                let tiSoA = row.TiSoA || row.tiSoA;
                let tiSoB = row.TiSoB || row.tiSoB;
                
                // X·ª≠ l√Ω gi√° tr·ªã t·ªâ s·ªë - ch·ªâ chuy·ªÉn th√†nh chu·ªói r·ªóng n·∫øu undefined/null/0
                tiSoA = (tiSoA === undefined || tiSoA === null || tiSoA === '') ? '' : String(tiSoA);
                tiSoB = (tiSoB === undefined || tiSoB === null || tiSoB === '') ? '' : String(tiSoB);
                
                if (khoi && doiA && doiB) {
                  const k = key(khoi, doiA, doiB);
                  newResults[k] = [tiSoA, tiSoB];
                }
              });
              
              results = newResults;
              localStorage.setItem('vts_results', JSON.stringify(results));
              refreshAll();
              showStatus('‚úÖ T·∫£i th√†nh c√¥ng ' + result.count + ' tr·∫≠n ƒë·∫•u t·ª´ Google Sheet!', 'success');
            } else {
              throw new Error(result.message || 'L·ªói kh√¥ng x√°c ƒë·ªãnh');
            }
          } catch (error) {
            console.error('L·ªói khi t·∫£i Google Sheet:', error);
            showStatus('‚ùå L·ªói: ' + error.message, 'error');
          }
          
          // Cleanup
          document.head.removeChild(script);
          delete window[callbackName];
        };
        
        // T·∫°o script tag cho JSONP
        const script = document.createElement('script');
        script.src = APPS_SCRIPT_URL + '?callback=' + callbackName;
        
        // X·ª≠ l√Ω l·ªói n·∫øu script kh√¥ng t·∫£i ƒë∆∞·ª£c
        script.onerror = function() {
          showStatus('‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn Google Apps Script. Ki·ªÉm tra URL ho·∫∑c th·ª≠ l·∫°i.', 'error');
          document.head.removeChild(script);
          delete window[callbackName];
        };
        
        document.head.appendChild(script);
      }
      
      // ƒê·∫©y d·ªØ li·ªáu l√™n Google Sheet (JSONP)
      function pushToGoogleSheet() {
        showStatus('‚¨ÜÔ∏è ƒêang ƒë·∫©y d·ªØ li·ªáu l√™n Google Sheet...', 'info');
        
        const groups = parseGroups();
        const resultsArray = [];
        
        // Th√™m d·ªØ li·ªáu v√≤ng b·∫£ng
        ['K4', 'K5'].forEach(g => {
          pairs(groups[g] || [], g).forEach(([a, b]) => {
            const [sa, sb] = getScore(g, a, b);
            resultsArray.push({
              khoi: g,
              doiA: a,
              doiB: b,
              tiSoA: sa || '',
              tiSoB: sb || ''
            });
          });
        });
        
        // Th√™m d·ªØ li·ªáu knockout (n·∫øu c√≥)
        const withPts = pointsFromResults(groups);
        const K4Top = withPts.K4.slice(0, 2);
        const K5Top = withPts.K5.slice(0, 2);
        
        // B√°n k·∫øt
        if (K4Top[0] && K5Top[1]) {
          const [sa, sb] = getScore('SF', K4Top[0].team, K5Top[1].team);
          if (sa || sb) {
            resultsArray.push({
              khoi: 'SF',
              doiA: K4Top[0].team,
              doiB: K5Top[1].team,
              tiSoA: sa || '',
              tiSoB: sb || ''
            });
          }
        }
        
        if (K5Top[0] && K4Top[1]) {
          const [sa, sb] = getScore('SF', K5Top[0].team, K4Top[1].team);
          if (sa || sb) {
            resultsArray.push({
              khoi: 'SF',
              doiA: K5Top[0].team,
              doiB: K4Top[1].team,
              tiSoA: sa || '',
              tiSoB: sb || ''
            });
          }
        }
        
        // Chung k·∫øt (n·∫øu c√≥ ng∆∞·ªùi th·∫Øng b√°n k·∫øt)
        const sf1Winner = getSemiFinalWinner(K4Top[0]?.team || '', K5Top[1]?.team || '', getScore('SF', K4Top[0]?.team || '', K5Top[1]?.team || ''));
        const sf2Winner = getSemiFinalWinner(K5Top[0]?.team || '', K4Top[1]?.team || '', getScore('SF', K5Top[0]?.team || '', K4Top[1]?.team || ''));
        
        if (sf1Winner !== '‚Äî' && sf2Winner !== '‚Äî' && sf1Winner !== 'Ch∆∞a ƒë·∫•u' && sf2Winner !== 'Ch∆∞a ƒë·∫•u') {
          const [sa, sb] = getScore('FINAL', sf1Winner, sf2Winner);
          if (sa || sb) {
            resultsArray.push({
              khoi: 'FINAL',
              doiA: sf1Winner,
              doiB: sf2Winner,
              tiSoA: sa || '',
              tiSoB: sb || ''
            });
          }
        }
        
        // T·∫°o callback function
        const callbackName = 'pushCallback_' + Date.now();
        
        window[callbackName] = function(result) {
          try {
            if (result.status === 'success') {
              showStatus('‚úÖ ƒê√£ c·∫≠p nh·∫≠t ' + result.count + ' tr·∫≠n l√™n Google Sheet!', 'success');
            } else {
              throw new Error(result.message || 'L·ªói khi c·∫≠p nh·∫≠t');
            }
          } catch (error) {
            console.error('L·ªói khi ƒë·∫©y l√™n Google Sheet:', error);
            showStatus('‚ùå L·ªói: ' + error.message, 'error');
          }
          
          // Cleanup
          document.head.removeChild(script);
          delete window[callbackName];
        };
        
        // T·∫°o script tag v·ªõi data
        const script = document.createElement('script');
        const dataParam = encodeURIComponent(JSON.stringify(resultsArray));
        script.src = APPS_SCRIPT_URL + '?action=update&data=' + dataParam + '&callback=' + callbackName;
        
        // X·ª≠ l√Ω l·ªói n·∫øu script kh√¥ng t·∫£i ƒë∆∞·ª£c
        script.onerror = function() {
          showStatus('‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn Google Apps Script. Ki·ªÉm tra URL ho·∫∑c th·ª≠ l·∫°i.', 'error');
          document.head.removeChild(script);
          delete window[callbackName];
        };
        
        document.head.appendChild(script);
      }
      
      // Event listeners
      $('#loadFromSheet').addEventListener('click', loadFromGoogleSheet);
      $('#exportData').addEventListener('click', () => {
        if (Object.keys(results).length === 0) {
          alert('Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t. H√£y nh·∫≠p t·ªâ s·ªë tr∆∞·ªõc!');
          return;
        }
        pushToGoogleSheet();
      });
      
      // T·ª± ƒë·ªông t·∫£i t·ª´ Google Sheet m·ªói 1 ph√∫t
      loadFromGoogleSheet(); // T·∫£i ngay khi v√†o trang
      setInterval(() => {
        // Ch·ªâ t·ª± ƒë·ªông t·∫£i khi kh√¥ng ·ªü ch·∫ø ƒë·ªô edit ƒë·ªÉ tr√°nh xung ƒë·ªôt
        if (!editEnabled) {
          loadFromGoogleSheet();
        }
      }, 60000); // T·∫£i l·∫°i m·ªói 1 ph√∫t
      
      // Kh·ªüi t·∫°o
      refreshAll();
    })();

    // ===== ALBUM NG·∫™U NHI√äN (KH√îNG API) =====
    (function(){
      const gal=document.getElementById('randomGallery');
      const images=[
        'https://images.unsplash.com/photo-1517481705099-9c63b7a1d829?q=80&w=1200&auto=format&fit=crop',
        'https://images.unsplash.com/photo-1461896836934-ffe607ba8211?q=80&w=1200&auto=format&fit=crop',
        'https://images.unsplash.com/photo-1522771739844-6a9f6d5f14af?q=80&w=1200&auto=format&fit=crop',
        'https://images.unsplash.com/photo-1509021436665-8f07dbf5bf1d?q=80&w=1200&auto=format&fit=crop',
        'https://images.unsplash.com/photo-1531592782745-6c6b6ad21d8f?q=80&w=1200&auto=format&fit=crop',
        'https://images.unsplash.com/photo-1531938716357-248c1df9fc6b?q=80&w=1200&auto=format&fit=crop'
      ];
      function refresh(){ gal.innerHTML=''; images.sort(()=>Math.random()-0.5).slice(0,6).forEach(u=>{ const img=new Image(); img.src=u; gal.appendChild(img); }); }
      refresh(); setInterval(refresh,4000);
    })();
  </script>
</body>
</html>
